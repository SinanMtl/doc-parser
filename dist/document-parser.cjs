"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const T=require("fs"),w=require("path");class z{constructor(){this.supportedExtensions=[".js",".jsx",".ts",".tsx",".vue",".html"],this.extractedTexts=[]}isNonTextualContent(t){const{text:e,isAttribute:n=!1,isJS:o=!1}=t;return[/^&[a-zA-Z]+;$/,/^https?:\/\//,/^\/[\/\w-]+$/,/^[0-9\s\-\+\(\)]+$/,/^[A-Z_]{5,}$/,/^\s*$/,/^[\w-]+\.(js|css|png|jpg|gif|svg)$/i,/^[a-z]+([A-Z][a-z]*)*$/,/^[a-z]+-[a-z-]+$/,/^[a-z]+_[a-z_]+$/i,/api\..*\.com/i,/^(ok|yes|no|true|false)$/i,/^\w{1,2}$/,/^\\[nrtbfv\\'"0]$/,/^[\\\/\*\{\}\[\]()<>;,.:!?'"=+\-~^&|%$#@]+$/,/^\/\*$/,/^\*\/$/,/^\/\/$/,/^[{}[\]()<>]$/,/^[;,.:!?'"]+$/,/^[+\-*/%=&|^~<>]+$/,/^\$\{/,/^.*\}$/,/^.*content\s*\+=/,/^;\s*$/,/^['"]\([^'"]*$/,/^\][^'"]*['"]*$/,/^[^'"]*\)['"]*$/,/^:\s*\n\s*case\s*$/,/^,\s*\n\s*$/,...o?[/^[A-Z][A-Z0-9_]{4,}$/]:[],/^[a-z]+[A-Z][a-z]*[A-Z][a-z]*$/,/^[a-z]+-[a-z]+-[a-z-]+$/,/^(src|alt|id|css|js|php|html|xml|json)$/i,...n?[]:[/^[a-zA-Z]*-[a-zA-Z-]*$/],/^[A-Z]+_[A-Z0-9_]+$/,/^[a-z]+([A-Z][a-z]*)+$/,/^\/.*\/[gimsuyx]*$/].some(r=>r.test(e.trim()))}getFileExtension(t){const e=t.split(".");return e.length>1?e[e.length-1].toLowerCase():""}parseFile(t){const e=w.extname(t).toLowerCase(),n=w.basename(t);try{const o=T.readFileSync(t,"utf8");return this.parseContent(o,e,{filePath:t,fileName:n})}catch(o){return console.error(`Error reading file ${t}:`,o.message),null}}parseContent(t,e,n){if(!this.supportedExtensions.includes(e))return console.warn(`Unsupported file type: ${e}`),null;t=this.escapeRegExp(t);const o=this.extractTextByType(t,e);return{...n||{},extension:e,extractedText:o,timestamp:new Date().toISOString()}}extractTextByType(t,e){const n={strings:[],htmlText:[],attributes:[],templateText:[],classNames:[],ids:[]};switch(e){case".js":case".ts":return this.parseJavaScriptTypeFiles(t);case".jsx":case".tsx":return this.parseJSXFile(t);case".vue":return this.parseVueFile(t);case".html":return this.parseHtmlFile(t);default:return n}}parseJavaScriptTypeFiles(t){const e={strings:[]},n=this.extractMeaningfulStringsWithPosition(t,"javascript");return e.strings.push(...n),e}parseJSXFile(t){const e={strings:[],classNames:[],ids:[]},n=/return\s*\(\s*([\s\S]*?)\s*\);/g,o=[...t.matchAll(n)],s=[];o.forEach(a=>{const g=a[1],i=a.index+a[0].indexOf(a[1]),l=i+g.length;s.push({start:i,end:l});const u=this.parseHtmlContent(g,!0,i,t,"html");e.strings.push(...u.htmlText),e.strings.push(...u.naturalLanguageAttributes)});const r=this.extractJavaScriptStringsExcludingJSX(t,s,"javascript");return e.strings.push(...r),e}extractJavaScriptStringsExcludingJSX(t,e,n="javascript"){const o=[];[/"(?:[^"\\]|\\.)*"/g,/'(?:[^'\\]|\\.)*'/g,/`(?:[^`\\]|\\.)*`/g].forEach(g=>{let i;for(;(i=g.exec(t))!==null;){const l=i.index,u=i.index+i[0].length;e.some(d=>l>=d.start&&u<=d.end)||o.push(i)}});const r=[],a=[/require\s*\(/,/import\s+.*\s+from\s+/,/export\s+.*\s+from\s+/];return o.forEach(g=>{const i=g[0],l=g.index,u=Math.max(0,l-100),c=t.substring(u,l+i.length+50);let d=a.some(h=>h.test(c));if(!d){const h=i.slice(1,-1),x=this.isInsideFunctionCall(t,l),p=t.substring(Math.max(0,l-200),l),f=/console\.(log|error|warn|info|debug|trace)\s*\(\s*['"`]*$/.test(p),E=[/^[\[\](){}.*+?^$\\|]+$/,/^\[.*\]$/,/^\(.*\)$/,/^\\[a-z]$/,/\[\^[^[\]]*\]/,/\$\{|\}\$/].some(P=>P.test(h)),S=/\$t\(|\\.t\(|i18n\\.t\(/.test(h),y=/\bt\s*\(/.test(h),$=h.length<=2,F=/^[^a-zA-Z0-9\s\u00C0-\u017F\u0100-\u024F\u1E00-\u1EFF\u0400-\u04FF\u0370-\u03FF\u0590-\u05FF\u0600-\u06FF\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF]+$/.test(h);d=E||S||y||$||F||x||f}if(!d){const h=i.slice(1,-1);if(h.trim().length>2&&!this.isNonTextualContent({text:h})){const x=this.getPositionInfo(t,l,l+i.length),p=l+1,f=l+i.length-1,m=this.getPositionInfo(t,p,f);r.push({text:h.replace(/\n/,"").trim(),type:"string",context:n,lineNumber:m.lineNumber,startPosition:m.columnStart,endPosition:m.columnEnd,columnStart:m.columnStart,columnEnd:m.columnEnd,absoluteStart:m.absoluteStart,absoluteEnd:m.absoluteEnd,originalStartPosition:x.columnStart,originalEndPosition:x.columnEnd,originalAbsoluteStart:x.absoluteStart,originalAbsoluteEnd:x.absoluteEnd,originalMatch:i})}}}),r}escapeRegExp(t){let e=t.replace(/^https?:\/\//gm,u=>" ".repeat(u.length));e=e.replace(/<[^>]*>/gm,u=>" ".repeat(u.length));let n;const o=/(\/\*([\s\S]*?)\*\/|[^\\]\/\/.+)/g;for(;(n=o.exec(e))!==null;){const u=n[0];for(const c of u.split(`
`))e=e.replace(c,"".padStart(c.length," "))}const s=/(\/(.*)\/+([gimuy]*))/gm;let r,a=-1,g=-1;for(;(r=s.exec(e))!==null;){a===-1&&(a=r.index);const u=r[0].replace(/^(!|=)\s{1,}?/,"").trim();try{const c=u.match(/^\/(.*)\/([gimuy]*)$/);if(c){const d=c[1],h=c[2];new RegExp(d,h),e=e.replace(u,`"${"".padStart(u.length-2,"*")}"`),g=r.index+u.length}}catch{continue}}const i=e.slice(a,g),l=t.slice(a,g);return t=t.replace(l,i),t}extractMeaningfulStringsWithPosition(t,e="javascript"){const n=[],o=[],s=/"(?:[^"\\]|\\.)*"/g;let r;for(;(r=s.exec(t))!==null;)o.push(r);const a=/'(?:[^'\\]|\\.)*'/g;for(;(r=a.exec(t))!==null;)o.push(r);const g=/`(?:[^`\\]|\\.|[\r\n])*`/g;for(;(r=g.exec(t))!==null;){const l=t.substring(Math.max(0,r.index-100),r.index),u=t.substring(r.index+r[0].length,r.index+r[0].length+20);/\[[^\]]*$/.test(l)&&/^[^\]]*\]/.test(u)||o.push(r)}const i=[/require\s*\(/,/import\s+.*\s+from\s+/,/export\s+.*\s+from\s+/];return o.forEach(l=>{const u=l[0],c=l.index,d=Math.max(0,c-100),h=t.substring(d,c+u.length+50);let x=i.some(p=>p.test(h));if(!x){const p=u.slice(1,-1),f=this.isInsideFunctionCall(t,c),m=t.substring(Math.max(0,c-200),c),E=/console\.(log|error|warn|info|debug|trace)\s*\(\s*['"`]*$/.test(m),y=[/^[\[\](){}.*+?^$\\|]+$/,/^\[.*\]$/,/^\(.*\)$/,/^\\[a-z]$/,/\[\^[^[\]]*\]/,/\$\{|\}\$/].some(M=>M.test(p)),$=/\$t\(|\\.t\(|i18n\\.t\(/.test(p),F=/\bt\s*\(/.test(p),P=p.length<=2,A=/^[^a-zA-Z0-9\s\u00C0-\u017F\u0100-\u024F\u1E00-\u1EFF\u0400-\u04FF\u0370-\u03FF\u0590-\u05FF\u0600-\u06FF\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF]+$/.test(p);x=y||$||F||P||A||f||E}if(!x){const p=u.slice(1,-1);if(p.trim().length>2&&!this.isNonTextualContent({text:p})){const f=this.getPositionInfo(t,c,c+u.length),m=c+1,E=c+u.length-1,S=this.getPositionInfo(t,m,E);n.push({text:p.replace(/\n/,"").trim(),type:"string",context:e,lineNumber:S.lineNumber,startPosition:S.columnStart,endPosition:S.columnEnd,columnStart:S.columnStart,columnEnd:S.columnEnd,absoluteStart:S.absoluteStart,absoluteEnd:S.absoluteEnd,originalStartPosition:f.columnStart,originalEndPosition:f.columnEnd,originalAbsoluteStart:f.absoluteStart,originalAbsoluteEnd:f.absoluteEnd,originalMatch:u})}}}),n}isHtmlAttributeValue(t,e){const n=Math.max(0,e-200),o=Math.min(t.length,e+200),s=t.substring(n,o),r=e-n,a=s.substring(0,r),g=s.substring(r+1),i=a.lastIndexOf("=");if(i===-1)return!1;const u=a.substring(0,i).trim().match(/([\w-]+)\s*$/);if(!u)return!1;const c=u[1].toLowerCase(),d=t[e];return g.indexOf(d)===-1?!1:/<[^>]*>/.test(s)&&(/^(class|classname|id|style|src|href|type|name|role|aria-\w+|data-\w+|key|ref|onclick|onchange|value|checked|disabled|readonly|placeholder|title|alt)$/i.test(c)||/^on[A-Z]/.test(c)||/^(v-|:)/.test(c)||c.includes("-")||c.toLowerCase().startsWith("data"))}isInsideFunctionCall(t,e){const n=Math.max(0,e-300),o=t.substring(n,e),s=[];for(let r=o.length-1;r>=0;r--)if(o[r]==="("){const a=o.substring(0,r).trim();/(\w+(\.\w+)*|\]\s*)$/.test(a)&&s.push(n+r)}for(const r of s){let a=1,g=null;for(let i=r+1;i<t.length&&a>0;i++)if(t[i]==="(")a++;else if(t[i]===")"&&(a--,a===0)){g=i;break}if(g&&e>r&&e<g)return!0}return!1}extractMeaningfulStrings(t){return this.extractMeaningfulStringsWithPosition(t,"html").map(e=>e.text)}parseVueFile(t){const e={htmlText:[],naturalLanguageAttributes:[],strings:[]},n=t.match(/<template[^>]*>([\s\S]*?)<\/template>/i);if(n){const s=n[1],r=t.indexOf(n[0])+n[0].indexOf(s),a=this.parseHtmlContent(s,!1,0,void 0,"vue");a.htmlText.forEach(g=>{g.absoluteStart+=r,g.absoluteEnd+=r,e.htmlText.push(g)}),a.naturalLanguageAttributes.forEach(g=>{g.absoluteStart+=r,g.absoluteEnd+=r,e.naturalLanguageAttributes.push(g)})}const o=t.match(/<script[^>]*>([\s\S]*?)<\/script>/i);if(o){const s=o[1],a=t.indexOf(o[0])+o[0].indexOf(s);this.parseJavaScriptTypeFiles(s).strings.forEach(i=>{const l=this.getPositionInfo(t,i.absoluteStart+a,i.absoluteEnd+a);i.lineNumber=l.lineNumber,i.startPosition=l.startPosition,i.endPosition=l.endPosition,i.absoluteStart+=a,i.absoluteEnd+=a,e.strings.push(i)})}return e}parseHtmlFile(t){const e={htmlText:[],naturalLanguageAttributes:[],strings:[]},n=this.parseHtmlContent(t,!1,0,void 0,"html");e.htmlText.push(...n.htmlText),e.naturalLanguageAttributes.push(...n.naturalLanguageAttributes);const o=t.matchAll(/<script[^>]*>([\s\S]*?)<\/script>/gi);for(const s of o){const r=s[1],g=t.indexOf(s[0])+s[0].indexOf(r);this.extractMeaningfulStringsWithPosition(r,"javascript").forEach(l=>{const u=this.getPositionInfo(t,l.absoluteStart+g,l.absoluteEnd+g);l.lineNumber=u.lineNumber,l.startPosition=u.startPosition,l.endPosition=u.endPosition,l.columnStart=u.columnStart,l.columnEnd=u.columnEnd,l.absoluteStart+=g,l.absoluteEnd+=g,e.strings.push(l)})}return e}parseHtmlContent(t,e=!1,n=0,o,s="html"){const r={htmlText:[],naturalLanguageAttributes:[]},a=["placeholder","title","alt","aria-label","label","value","aria-description","aria-labelledby","data-tooltip","data-title","data-description","data-placeholder","data-label"];return t.replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?<\/style>/gi,""),[...t.matchAll(/>([^<]*?)</gs)].forEach(i=>{let l=i[1].trim().replace(/\s+/g," ").replace(/\n/g," ");if(l&&l.length>0&&!this.isNonTextualContent({text:l})){const u=i.index,c=t.substring(0,u+1),d=(c.match(/<script\b[^>]*>/gi)||[]).length,h=(c.match(/<\/script>/gi)||[]).length,x=(c.match(/<style\b[^>]*>/gi)||[]).length,p=(c.match(/<\/style>/gi)||[]).length,f=d>h,m=x>p;if(!f&&!m){const E=e&&(l.includes("{")||l.includes("}")),S=l.includes("{{")&&l.includes("}}");if(!E&&!S){const y=o||t,$=i.index+n,F=i.index+i[0].length+n,P=this.getPositionInfo(y,$,F),A=i[1],M=A.trim(),b=i.index+1+A.indexOf(M)+n,N=y.substring(0,b).split(`
`),L=N.length,v=N[N.length-1].length,j=M.length,I=v+j,C={lineNumber:L,columnStart:v,columnEnd:I,absoluteStart:b,absoluteEnd:b+j};r.htmlText.push({text:l.replace(/\n/,"").trim(),type:"htmlText",context:s,lineNumber:C.lineNumber,startPosition:C.columnStart,endPosition:C.columnEnd,columnStart:C.columnStart,columnEnd:C.columnEnd,absoluteStart:C.absoluteStart,absoluteEnd:C.absoluteEnd,originalStartPosition:P.columnStart,originalEndPosition:P.columnEnd,originalAbsoluteStart:P.absoluteStart,originalAbsoluteEnd:P.absoluteEnd,originalMatch:i[0]})}}}}),a.forEach(i=>{const l=new RegExp(`\\b${i}\\s*=\\s*["']([^"']+)["']`,"gi");[...t.matchAll(l)].forEach(c=>{const d=c[1].trim(),h=c[0],x=c.index,f=(x>0?t[x-1]:"")===":",m=e&&(d.includes("{")||d.includes("}"));if(!f&&!m&&d&&d.length>0&&!this.isNonTextualContent({text:d,isAttribute:!0})){const E=o||t,S=c.index+n,y=c.index+h.length+n,$=this.getPositionInfo(E,S,y),F=h.indexOf('"')+1,P=h.lastIndexOf('"'),A=c.index+F+n,M=c.index+P+n,b=this.getPositionInfo(E,A,M);r.naturalLanguageAttributes.push({text:d.replace(/\n/,"").trim(),type:"attribute",context:s,attribute:i,lineNumber:b.lineNumber,startPosition:b.columnStart,endPosition:b.columnEnd,columnStart:b.columnStart,columnEnd:b.columnEnd,absoluteStart:b.absoluteStart,absoluteEnd:b.absoluteEnd,originalStartPosition:$.columnStart,originalEndPosition:$.columnEnd,originalAbsoluteStart:$.absoluteStart,originalAbsoluteEnd:$.absoluteEnd,originalMatch:h})}})}),r}getPositionInfo(t,e,n){const s=t.substring(0,e).split(`
`),r=s.length,a=s[s.length-1].length,g=n-e,i=a+g;return{lineNumber:r,startPosition:a,endPosition:i,columnStart:a,columnEnd:i,absoluteStart:e,absoluteEnd:n}}parseDirectory(t){const e=[];try{const n=T.readdirSync(t);for(const o of n){const s=w.join(t,o),r=T.statSync(s);if(r.isDirectory())["node_modules",".git",".next","dist","build",".vscode"].includes(o)||e.push(...this.parseDirectory(s));else if(r.isFile()){const a=this.parseFile(s);a&&e.push(a)}}}catch(n){console.error(`Error reading directory ${t}:`,n.message)}return e.filter(Boolean)}filterMeaningfulText(t){return t.filter(e=>!e||typeof e!="string"||e.trim().length===0||e.trim().length<2?!1:![/^[0-9]+$/,/^[^a-zA-Z]*$/,/^(true|false|null|undefined)$/i,/^(div|span|p|h[1-6]|img|a|li|ul|ol)$/i,/^[\s\n\r\t]+$/].some(o=>o.test(e.trim()))).map(e=>e.trim())}generateSummary(t){const e={totalFiles:t.length,fileTypes:{},totalTexts:0,textTypes:{htmlText:0,naturalLanguageAttributes:0,strings:0},allTexts:[]};return t.forEach(n=>{const o=n.extension;e.fileTypes[o]=(e.fileTypes[o]||0)+1,Object.keys(n.extractedText).forEach(s=>{const r=n.extractedText[s];Array.isArray(r)&&(e.textTypes[s]=(e.textTypes[s]||0)+r.length,e.totalTexts+=r.length,r.forEach(a=>{typeof a=="object"&&a.text&&e.allTexts.push({...a,file:n.fileName,filePath:n.filePath})}))})}),e.allTexts.sort((n,o)=>(n?.lineNumber??0)!==(o?.lineNumber??0)?(n?.lineNumber??0)-(o?.lineNumber??0):(n?.startPosition??0)-(o?.startPosition??0)),e}exportToJson(t,e){const n=this.generateSummary(t),o={metadata:{timestamp:new Date().toISOString(),totalFiles:t.length,supportedExtensions:this.supportedExtensions},summary:n,detailedResults:t};try{const s=w.dirname(e);T.existsSync(s)||(T.mkdirSync(s,{recursive:!0}),console.log(`Created directory: ${s}`)),T.writeFileSync(e,JSON.stringify(o,null,2),"utf8"),console.log(`Results exported to: ${e}`)}catch(s){console.error(`Error writing to file: ${s.message}`)}}exportToText(t,e){const n=this.generateSummary(t);let o=`Document Parser Results
`;o+=`======================

`,o+=`Total Files Processed: ${n.totalFiles}
`,o+=`Total Meaningful Texts Found: ${n.totalTexts}

`,o+=`File Types:
`,Object.keys(n.fileTypes).forEach(s=>{o+=`  ${s}: ${n.fileTypes[s]} files
`}),o+=`
Text Types:
`,Object.keys(n.textTypes).forEach(s=>{o+=`  ${s}: ${n.textTypes[s]} items
`}),o+=`

All Meaningful Texts with Position Info:
`,o+=`========================================

`,n.allTexts.forEach((s,r)=>{let a=`${r+1}. [${s.type}] ${s.file}`;s.lineNumber&&(a+=` (Line: ${s.lineNumber}, Pos: ${s.startPosition}-${s.endPosition})`),s.attribute&&(a+=` [${s.attribute}]`),a+=`: "${s.text}"`,s.originalMatch&&s.originalMatch!==s.text&&(a+=` | Original: ${s.originalMatch}`),o+=a+`
`});try{const s=w.dirname(e);T.existsSync(s)||(T.mkdirSync(s,{recursive:!0}),console.log(`Created directory: ${s}`)),T.writeFileSync(e,o,"utf8"),console.log(`Text results exported to: ${e}`)}catch(s){console.error(`Error writing to file: ${s.message}`)}}}exports.DocumentParser=z;exports.default=z;

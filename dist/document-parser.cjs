"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const P=require("fs"),w=require("path");class I{constructor(){this.supportedExtensions=[".js",".jsx",".ts",".tsx",".vue",".html"],this.extractedTexts=[]}isNonTextualContent(t){const{text:e,isAttribute:n=!1,isJS:o=!1}=t;return[/^&[a-zA-Z]+;$/,/^https?:\/\//,/^\/[\/\w-]+$/,/^[0-9\s\-\+\(\)]+$/,/^[A-Z_]{5,}$/,/^\s*$/,/^[\w-]+\.(js|css|png|jpg|gif|svg)$/i,/^[a-z]+([A-Z][a-z]*)*$/,/^[a-z]+-[a-z-]+$/,/^[a-z]+_[a-z_]+$/i,/api\..*\.com/i,/^(ok|yes|no|true|false)$/i,/^\w{1,2}$/,/^\\[nrtbfv\\'"0]$/,/^[\\\/\*\{\}\[\]()<>;,.:!?'"=+\-~^&|%$#@]+$/,/^\/\*$/,/^\*\/$/,/^\/\/$/,/^[{}[\]()<>]$/,/^[;,.:!?'"]+$/,/^[+\-*/%=&|^~<>]+$/,/^\$\{/,/^.*\}$/,/^.*content\s*\+=/,/^;\s*$/,/^['"]\([^'"]*$/,/^\][^'"]*['"]*$/,/^[^'"]*\)['"]*$/,/^:\s*\n\s*case\s*$/,/^,\s*\n\s*$/,...o?[/^[A-Z][A-Z0-9_]{4,}$/]:[],/^[a-z]+[A-Z][a-z]*[A-Z][a-z]*$/,/^[a-z]+-[a-z]+-[a-z-]+$/,/^(src|alt|id|css|js|php|html|xml|json)$/i,...n?[]:[/^[a-zA-Z]*-[a-zA-Z-]*$/],/^[A-Z]+_[A-Z0-9_]+$/,/^[a-z]+([A-Z][a-z]*)+$/,/^\/.*\/[gimsuyx]*$/].some(r=>r.test(e.trim()))}getFileExtension(t){const e=t.split(".");return e.length>1?e[e.length-1].toLowerCase():""}parseFile(t){const e=w.extname(t).toLowerCase(),n=w.basename(t);try{const o=P.readFileSync(t,"utf8");return this.parseContent(o,e,{filePath:t,fileName:n})}catch(o){return console.error(`Error reading file ${t}:`,o.message),null}}parseContent(t,e,n){if(!this.supportedExtensions.includes(e))return console.warn(`Unsupported file type: ${e}`),null;t=this.escapeRegExp(t);const o=this.extractTextByType(t,e);return{...n||{},extension:e,extractedText:o,timestamp:new Date().toISOString()}}extractTextByType(t,e){const n={strings:[],htmlText:[],attributes:[],templateText:[],classNames:[],ids:[]};switch(e){case".js":case".ts":return this.parseJavaScriptTypeFiles(t);case".jsx":case".tsx":return this.parseJSXFile(t);case".vue":return this.parseVueFile(t);case".html":return this.parseHtmlFile(t);default:return n}}parseJavaScriptTypeFiles(t){const e={strings:[]},n=this.extractMeaningfulStringsWithPosition(t,"javascript");return e.strings.push(...n),e}parseJSXFile(t){const e={strings:[],classNames:[],ids:[]},n=/return\s*\(\s*([\s\S]*?)\s*\);/g,o=[...t.matchAll(n)],s=[];o.forEach(l=>{const g=l[1],a=l.index+l[0].indexOf(l[1]),i=a+g.length;s.push({start:a,end:i});const u=this.parseHtmlContent(g,!0,a,t,"html");e.strings.push(...u.htmlText),e.strings.push(...u.naturalLanguageAttributes)});const r=this.extractJavaScriptStringsExcludingJSX(t,s,"javascript");return e.strings.push(...r),e}extractJavaScriptStringsExcludingJSX(t,e,n="javascript"){const o=[];[/"(?:[^"\\]|\\.)*"/g,/'(?:[^'\\]|\\.)*'/g,/`(?:[^`\\]|\\.)*`/g].forEach(g=>{let a;for(;(a=g.exec(t))!==null;){const i=a.index,u=a.index+a[0].length;e.some(x=>i>=x.start&&u<=x.end)||o.push(a)}});const r=[],l=[/require\s*\(/,/import\s+.*\s+from\s+/,/export\s+.*\s+from\s+/];return o.forEach(g=>{const a=g[0],i=g.index,u=Math.max(0,i-100),c=t.substring(u,i+a.length+50);let x=l.some(d=>d.test(c));if(!x){const d=a.slice(1,-1),p=this.isInsideFunctionCall(t,i),h=t.substring(Math.max(0,i-200),i),f=/console\.(log|error|warn|info|debug|trace)\s*\(\s*['"`]*$/.test(h),b=[/^[\[\](){}.*+?^$\\|]+$/,/^\[.*\]$/,/^\(.*\)$/,/^\\[a-z]$/,/\[\^[^[\]]*\]/,/\$\{|\}\$/].some(C=>C.test(d)),S=/\$t\(|\\.t\(|i18n\\.t\(/.test(d),F=/\bt\s*\(/.test(d),E=d.length<=2,T=/^[^a-zA-Z0-9\s\u00C0-\u017F\u0100-\u024F\u1E00-\u1EFF\u0400-\u04FF\u0370-\u03FF\u0590-\u05FF\u0600-\u06FF\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF]+$/.test(d);x=b||S||F||E||T||p||f}if(!x){const d=a.slice(1,-1);if(d.trim().length>2&&!this.isNonTextualContent({text:d})){const p=this.getPositionInfo(t,i,i+a.length),h=i+1,f=i+a.length-1,m=this.getPositionInfo(t,h,f);r.push({text:d.replace(/\n/,"").trim(),type:"string",context:n,lineNumber:m.lineNumber,startPosition:m.columnStart,endPosition:m.columnEnd,columnStart:m.columnStart,columnEnd:m.columnEnd,absoluteStart:m.absoluteStart,absoluteEnd:m.absoluteEnd,originalStartPosition:p.columnStart,originalEndPosition:p.columnEnd,originalAbsoluteStart:p.absoluteStart,originalAbsoluteEnd:p.absoluteEnd,originalMatch:a})}}}),r}escapeRegExp(t){let e=t.replace(/^https?:\/\//gm,u=>" ".repeat(u.length));e=e.replace(/<[^>]*>/gm,u=>" ".repeat(u.length));let n;const o=/(\/\*([\s\S]*?)\*\/|[^\\]\/\/.+)/g;for(;(n=o.exec(e))!==null;){const u=n[0];for(const c of u.split(`
`))e=e.replace(c,"".padStart(c.length," "))}const s=/(\/(.*)\/+([gimuy]*))/gm;let r,l=-1,g=-1;for(;(r=s.exec(e))!==null;){l===-1&&(l=r.index);const u=r[0].replace(/^(!|=)\s{1,}?/,"").trim();try{const c=u.match(/^\/(.*)\/([gimuy]*)$/);if(c){const x=c[1],d=c[2];new RegExp(x,d),e=e.replace(u,`"${"".padStart(u.length-2,"*")}"`),g=r.index+u.length}}catch{continue}}const a=e.slice(l,g),i=t.slice(l,g);return t=t.replace(i,a),t}extractMeaningfulStringsWithPosition(t,e="javascript"){const n=[],o=[],s=/"(?:[^"\\]|\\.)*"/g;let r;for(;(r=s.exec(t))!==null;)o.push(r);const l=/'(?:[^'\\]|\\.)*'/g;for(;(r=l.exec(t))!==null;)o.push(r);const g=/`(?:[^`\\]|\\.|[\r\n])*`/g;for(;(r=g.exec(t))!==null;){const i=t.substring(Math.max(0,r.index-100),r.index),u=t.substring(r.index+r[0].length,r.index+r[0].length+20);/\[[^\]]*$/.test(i)&&/^[^\]]*\]/.test(u)||o.push(r)}const a=[/require\s*\(/,/import\s+.*\s+from\s+/,/export\s+.*\s+from\s+/];return o.forEach(i=>{const u=i[0],c=i.index,x=Math.max(0,c-100),d=t.substring(x,c+u.length+50);let p=a.some(h=>h.test(d));if(!p){const h=u.slice(1,-1),f=this.isInsideFunctionCall(t,c),m=t.substring(Math.max(0,c-200),c),b=/console\.(log|error|warn|info|debug|trace)\s*\(\s*['"`]*$/.test(m),F=[/^[\[\](){}.*+?^$\\|]+$/,/^\[.*\]$/,/^\(.*\)$/,/^\\[a-z]$/,/\[\^[^[\]]*\]/,/\$\{|\}\$/].some(y=>y.test(h)),E=/\$t\(|\\.t\(|i18n\\.t\(/.test(h),T=/\bt\s*\(/.test(h),C=h.length<=2,M=/^[^a-zA-Z0-9\s\u00C0-\u017F\u0100-\u024F\u1E00-\u1EFF\u0400-\u04FF\u0370-\u03FF\u0590-\u05FF\u0600-\u06FF\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF]+$/.test(h);p=F||E||T||C||M||f||b}if(!p){const h=u.slice(1,-1);if(h.trim().length>2&&!this.isNonTextualContent({text:h})){const f=this.getPositionInfo(t,c,c+u.length),m=c+1,b=c+u.length-1,S=this.getPositionInfo(t,m,b);n.push({text:h.replace(/\n/,"").trim(),type:"string",context:e,lineNumber:S.lineNumber,startPosition:S.columnStart,endPosition:S.columnEnd,columnStart:S.columnStart,columnEnd:S.columnEnd,absoluteStart:S.absoluteStart,absoluteEnd:S.absoluteEnd,originalStartPosition:f.columnStart,originalEndPosition:f.columnEnd,originalAbsoluteStart:f.absoluteStart,originalAbsoluteEnd:f.absoluteEnd,originalMatch:u})}}}),n}isHtmlAttributeValue(t,e){const n=Math.max(0,e-200),o=Math.min(t.length,e+200),s=t.substring(n,o),r=e-n,l=s.substring(0,r),g=s.substring(r+1),a=l.lastIndexOf("=");if(a===-1)return!1;const u=l.substring(0,a).trim().match(/([\w-]+)\s*$/);if(!u)return!1;const c=u[1].toLowerCase(),x=t[e];return g.indexOf(x)===-1?!1:/<[^>]*>/.test(s)&&(/^(class|classname|id|style|src|href|type|name|role|aria-\w+|data-\w+|key|ref|onclick|onchange|value|checked|disabled|readonly|placeholder|title|alt)$/i.test(c)||/^on[A-Z]/.test(c)||/^(v-|:)/.test(c)||c.includes("-")||c.toLowerCase().startsWith("data"))}isInsideFunctionCall(t,e){const n=Math.max(0,e-300),o=t.substring(n,e),s=[];for(let r=o.length-1;r>=0;r--)if(o[r]==="("){const l=o.substring(0,r).trim();/(\w+(\.\w+)*|\]\s*)$/.test(l)&&s.push(n+r)}for(const r of s){let l=1,g=null;for(let a=r+1;a<t.length&&l>0;a++)if(t[a]==="(")l++;else if(t[a]===")"&&(l--,l===0)){g=a;break}if(g&&e>r&&e<g)return!0}return!1}extractMeaningfulStrings(t){return this.extractMeaningfulStringsWithPosition(t,"html").map(e=>e.text)}parseVueFile(t){const e={htmlText:[],naturalLanguageAttributes:[],strings:[]},n=t.match(/<template[^>]*>([\s\S]*?)<\/template>/i);if(n){const s=n[1],r=t.indexOf(n[0])+n[0].indexOf(s),l=this.parseHtmlContent(s,!1,0,void 0,"vue");l.htmlText.forEach(g=>{g.absoluteStart+=r,g.absoluteEnd+=r,e.htmlText.push(g)}),l.naturalLanguageAttributes.forEach(g=>{g.absoluteStart+=r,g.absoluteEnd+=r,e.naturalLanguageAttributes.push(g)})}const o=t.match(/<script[^>]*>([\s\S]*?)<\/script>/i);if(o){const s=o[1],l=t.indexOf(o[0])+o[0].indexOf(s);this.parseJavaScriptTypeFiles(s).strings.forEach(a=>{const i=this.getPositionInfo(t,a.absoluteStart+l,a.absoluteEnd+l);a.lineNumber=i.lineNumber,a.startPosition=i.startPosition,a.endPosition=i.endPosition,a.absoluteStart+=l,a.absoluteEnd+=l,e.strings.push(a)})}return e}parseHtmlFile(t){const e={htmlText:[],naturalLanguageAttributes:[],strings:[]},n=this.parseHtmlContent(t,!1,0,void 0,"html");e.htmlText.push(...n.htmlText),e.naturalLanguageAttributes.push(...n.naturalLanguageAttributes);const o=t.matchAll(/<script[^>]*>([\s\S]*?)<\/script>/gi);for(const s of o){const r=s[1],g=t.indexOf(s[0])+s[0].indexOf(r);this.extractMeaningfulStringsWithPosition(r,"javascript").forEach(i=>{const u=this.getPositionInfo(t,i.absoluteStart+g,i.absoluteEnd+g);i.lineNumber=u.lineNumber,i.startPosition=u.startPosition,i.endPosition=u.endPosition,i.columnStart=u.columnStart,i.columnEnd=u.columnEnd,i.absoluteStart+=g,i.absoluteEnd+=g,e.strings.push(i)})}return e}parseHtmlContent(t,e=!1,n=0,o,s="html"){const r={htmlText:[],naturalLanguageAttributes:[]},l=["placeholder","title","alt","aria-label","label","value","aria-description","aria-labelledby","data-tooltip","data-title","data-description","data-placeholder","data-label"];return t.replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?<\/style>/gi,""),[...t.matchAll(/>([^<]*?)</gs)].forEach(a=>{let i=a[1].trim().replace(/\s+/g," ").replace(/\n/g," ");if(i&&i.length>0&&!this.isNonTextualContent({text:i})){const u=a.index,c=t.substring(0,u+1),x=(c.match(/<script\b[^>]*>/gi)||[]).length,d=(c.match(/<\/script>/gi)||[]).length,p=(c.match(/<style\b[^>]*>/gi)||[]).length,h=(c.match(/<\/style>/gi)||[]).length,f=x>d,m=p>h;if(!f&&!m){const b=e&&(i.includes("{")||i.includes("}")),S=i.includes("{{")&&i.includes("}}"),F=i.includes(":")&&/:\w+\s*=/.test(i),E=/\w+\([^)]*\)/.test(i)||/\w+\.\w+/.test(i)||/\w+:\s*['"]/.test(i)||i.includes("=>")||i.includes("function")||/\$t\(/.test(i);if(!b&&!S&&!F&&!E){const T=o||t,C=a.index+n,M=a.index+a[0].length+n,y=this.getPositionInfo(T,C,M),$=a[1],j=$.trim(),N=a.index+1+$.indexOf(j)+n,v=T.substring(0,N).split(`
`),R=v.length,L=v[v.length-1].length,z=j.length,J=L+z,A={lineNumber:R,columnStart:L,columnEnd:J,absoluteStart:N,absoluteEnd:N+z};r.htmlText.push({text:i.replace(/\n/,"").trim(),type:"htmlText",context:s,lineNumber:A.lineNumber,startPosition:A.columnStart,endPosition:A.columnEnd,columnStart:A.columnStart,columnEnd:A.columnEnd,absoluteStart:A.absoluteStart,absoluteEnd:A.absoluteEnd,originalStartPosition:y.columnStart,originalEndPosition:y.columnEnd,originalAbsoluteStart:y.absoluteStart,originalAbsoluteEnd:y.absoluteEnd,originalMatch:a[0]})}}}}),l.forEach(a=>{const i=new RegExp(`(:|^|\\s)(${a})\\s*=\\s*["']([^"']+)["']`,"gi");[...t.matchAll(i)].forEach(c=>{const x=c[1],d=c[2],p=c[3].trim(),h=c[0];c.index;const f=x===":",m=e&&(p.includes("{")||p.includes("}"));if(!f&&!m&&p&&p.length>0&&!this.isNonTextualContent({text:p,isAttribute:!0})){const b=o||t,S=c.index+n,F=c.index+h.length+n,E=this.getPositionInfo(b,S,F),T=h.indexOf('"')+1,C=h.lastIndexOf('"'),M=c.index+T+n,y=c.index+C+n,$=this.getPositionInfo(b,M,y);r.naturalLanguageAttributes.push({text:p.replace(/\n/,"").trim(),type:"attribute",context:s,attribute:d,lineNumber:$.lineNumber,startPosition:$.columnStart,endPosition:$.columnEnd,columnStart:$.columnStart,columnEnd:$.columnEnd,absoluteStart:$.absoluteStart,absoluteEnd:$.absoluteEnd,originalStartPosition:E.columnStart,originalEndPosition:E.columnEnd,originalAbsoluteStart:E.absoluteStart,originalAbsoluteEnd:E.absoluteEnd,originalMatch:h})}})}),r}getPositionInfo(t,e,n){const s=t.substring(0,e).split(`
`),r=s.length,l=s[s.length-1].length,g=n-e,a=l+g;return{lineNumber:r,startPosition:l,endPosition:a,columnStart:l,columnEnd:a,absoluteStart:e,absoluteEnd:n}}parseDirectory(t){const e=[];try{const n=P.readdirSync(t);for(const o of n){const s=w.join(t,o),r=P.statSync(s);if(r.isDirectory())["node_modules",".git",".next","dist","build",".vscode"].includes(o)||e.push(...this.parseDirectory(s));else if(r.isFile()){const l=this.parseFile(s);l&&e.push(l)}}}catch(n){console.error(`Error reading directory ${t}:`,n.message)}return e.filter(Boolean)}filterMeaningfulText(t){return t.filter(e=>!e||typeof e!="string"||e.trim().length===0||e.trim().length<2?!1:![/^[0-9]+$/,/^[^a-zA-Z]*$/,/^(true|false|null|undefined)$/i,/^(div|span|p|h[1-6]|img|a|li|ul|ol)$/i,/^[\s\n\r\t]+$/].some(o=>o.test(e.trim()))).map(e=>e.trim())}generateSummary(t){const e={totalFiles:t.length,fileTypes:{},totalTexts:0,textTypes:{htmlText:0,naturalLanguageAttributes:0,strings:0},allTexts:[]};return t.forEach(n=>{const o=n.extension;e.fileTypes[o]=(e.fileTypes[o]||0)+1,Object.keys(n.extractedText).forEach(s=>{const r=n.extractedText[s];Array.isArray(r)&&(e.textTypes[s]=(e.textTypes[s]||0)+r.length,e.totalTexts+=r.length,r.forEach(l=>{typeof l=="object"&&l.text&&e.allTexts.push({...l,file:n.fileName,filePath:n.filePath})}))})}),e.allTexts.sort((n,o)=>(n?.lineNumber??0)!==(o?.lineNumber??0)?(n?.lineNumber??0)-(o?.lineNumber??0):(n?.startPosition??0)-(o?.startPosition??0)),e}exportToJson(t,e){const n=this.generateSummary(t),o={metadata:{timestamp:new Date().toISOString(),totalFiles:t.length,supportedExtensions:this.supportedExtensions},summary:n,detailedResults:t};try{const s=w.dirname(e);P.existsSync(s)||(P.mkdirSync(s,{recursive:!0}),console.log(`Created directory: ${s}`)),P.writeFileSync(e,JSON.stringify(o,null,2),"utf8"),console.log(`Results exported to: ${e}`)}catch(s){console.error(`Error writing to file: ${s.message}`)}}exportToText(t,e){const n=this.generateSummary(t);let o=`Document Parser Results
`;o+=`======================

`,o+=`Total Files Processed: ${n.totalFiles}
`,o+=`Total Meaningful Texts Found: ${n.totalTexts}

`,o+=`File Types:
`,Object.keys(n.fileTypes).forEach(s=>{o+=`  ${s}: ${n.fileTypes[s]} files
`}),o+=`
Text Types:
`,Object.keys(n.textTypes).forEach(s=>{o+=`  ${s}: ${n.textTypes[s]} items
`}),o+=`

All Meaningful Texts with Position Info:
`,o+=`========================================

`,n.allTexts.forEach((s,r)=>{let l=`${r+1}. [${s.type}] ${s.file}`;s.lineNumber&&(l+=` (Line: ${s.lineNumber}, Pos: ${s.startPosition}-${s.endPosition})`),s.attribute&&(l+=` [${s.attribute}]`),l+=`: "${s.text}"`,s.originalMatch&&s.originalMatch!==s.text&&(l+=` | Original: ${s.originalMatch}`),o+=l+`
`});try{const s=w.dirname(e);P.existsSync(s)||(P.mkdirSync(s,{recursive:!0}),console.log(`Created directory: ${s}`)),P.writeFileSync(e,o,"utf8"),console.log(`Text results exported to: ${e}`)}catch(s){console.error(`Error writing to file: ${s.message}`)}}}exports.DocumentParser=I;exports.default=I;
